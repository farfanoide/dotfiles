# -*- mode: tmux -*-
# vi: set ft=tmux :

# use 256 term for pretty colors
# Default termtype. If the rcfile sets $TERM, that overrides this value.
set -g default-terminal "screen-256color"

# Vim-like navigation
set-window-option -g mode-keys vi

# use zsh as default shell
# set-option -g default-command /usr/local/bin/zsh --login
set-option -g default-shell /usr/bin/zsh

# increase scroll-back history
set -g history-limit 5000

# use vim key bindings
# setw -g mode-keys vi

# copy parent environment variabels
set -g update-environment -r

# enable mouse
set -g mode-mouse on
set -g mouse-select-pane on
set -g mouse-resize-pane on
set -g mouse-select-window on

# decrease command delay (increases vim responsiveness)
set -sg escape-time 1

# # increase repeat time for repeatable commands
# set -g repeat-time 1000

# # start window index at 1
set -g base-index 1

# # start pane index at 1
setw -g pane-base-index 1

# # highlight window when it has new activity
setw -g monitor-activity on
set -g visual-activity on

# # re-number windows when one is closed
set -g renumber-windows on

# now we hide that ugly reattach window name
setw -g automatic-rename on

###########################
#  Key Bindings
###########################

# tmux prefix
# unbind C-b
# set -g prefix C-a
# prefix inception => tmux within a tmux
bind-key b send-prefix
# # paste
# unbind C-p
# bind C-p paste-buffer

# window splitting
# unbind %
bind \ split-window -h
# unbind '"'
bind - split-window -v

# Resize Panes
# http://tangledhelix.com/blog/2012/04/28/iterm2-keymaps-for-tmux/
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# seamles vim/tmux navigation
# Select Panes
# smart pane switching with awareness of vim splits
bind -n C-h run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-h) || tmux select-pane -L"
bind -n C-j run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-j) || tmux select-pane -D"
bind -n C-k run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-k) || tmux select-pane -U"
bind -n C-l run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys C-l) || tmux select-pane -R"
bind -n C-\ run "(tmux display-message -p '#{pane_current_command}' | grep -iq vim && tmux send-keys 'C-\\') || tmux select-pane -l"

# it's nice to jump fast between windows but whata about clearing screen?
bind C-l send-keys 'C-l'

unbind-key j
unbind-key k
unbind-key h
unbind-key l

bind-key -r j select-pane -D
bind-key -r k select-pane -U
bind-key -r h select-pane -L
bind-key -r l select-pane -R

# Sync Panes
unbind y
bind y setw synchronize-panes

# List Panes
# unbind u
#bind u choose-pane

# # create 25% lower split
# unbind t
# bind t split-window -p 25

# # quickly switch panes
# unbind ^J
# bind ^J select-pane -t :.+

# # force a reload of the config file
unbind r
bind r source-file ~/.tmux.conf \; display "Reloaded!"

###########################
# Status Bar
###########################

# enable UTF-8 support
set -g status-utf8 on
set -g utf8
set-window-option -g utf8 on

# set refresh interval for status bar
set -g status-interval 30

# center the status bar
set -g status-justify left


###########################
# Colors
###########################

# color status bar
#set -g status-bg colour235
#set -g status-fg white

# highlight current window
# set-window-option -g window-status-current-fg black
# set-window-option -g window-status-current-bg green

# set color of active pane
set -g pane-border-fg white
#set -g pane-border-bg black
set -g pane-active-border-fg blue
#set -g pane-active-border-bg black


# Ring the bell if any background window rang a bell
set -g bell-action any

# Watch for activity in background windows
setw -g monitor-activity on

# # Keep your finger on ctrl, or don't
bind-key ^D detach-client
bind-key ^C new-window
bind-key ^Z resize-pane -Z

# Powerline Stuff
set -g status-fg colour231
set -g status-bg colour234

set -g status on
set -g status-interval 2
set -g status-fg colour222
set -g status-bg colour234
set -g status-left-length 20
set -g status-right-length 150
set -g status-right "#[fg=colour45]%d %b %R #[fg=colour155]| #H "
set -g window-status-format "#[fg=colour244,bg=colour234]#I #[fg=colour240] #[default]#W "
set -g window-status-current-format "#[fg=colour236,bg=colour31]#[fg=colour117,bg=colour31] #I  #[fg=colour231,bold]#W #[fg=colour31,bg=colour234,nobold]"
set-window-option -g window-status-fg colour249
set-window-option -g window-status-activity-attr none
set-window-option -g window-status-bell-attr none
set-window-option -g window-status-activity-fg yellow
set-window-option -g window-status-bell-fg red

# load mac specific conf
if-shell 'test "$(uname)" = "Darwin"' 'source ~/.tmux-osx.conf'

# Add binding for tmuxstart sessions
bind S command-prompt -p "Make/attach session" "new-window 'tmuxstart \'%%\''"
